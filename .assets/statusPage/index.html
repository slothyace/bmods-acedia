<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title id="tabName">Loading...</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
    <style>
      body {
        background-color: #2e2e2e;
      }
      #statusPageBanner {
        font-size: 32px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #ffffff;
        text-align: center;
      }
      #uptimeBanner {
        font-size: 24px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #ffffff;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1 id="statusPageBanner">Loading...</h1>
    <div>
      <h2 id="uptimeBanner">Loading...</h2>
    </div>
    <script>
      let updateInterval = 1000
      let initialisedConstant = false
      let rawData

      const formatUptime = (uptime)=>{
        uptime = Math.floor(Number(uptime))
        let leftOverSeconds = uptime
        let days = Math.floor(leftOverSeconds/(60*60*24))
        leftOverSeconds %= (60*60*24)
        let hours = Math.floor(leftOverSeconds/(60*60))
        leftOverSeconds %= (60*60)
        let minutes = Math.floor(leftOverSeconds/60)
        leftOverSeconds %= 60
        let seconds = leftOverSeconds
        return `${String(days).padStart(2, "0")}D: ${String(hours).padStart(2, "0")}H: ${String(minutes).padStart(2, "0")}M: ${String(seconds).padStart(2, "0")}S`
      }

      async function fetchRawData(){
        rawResponse = await fetch("/raw")
        rawData = await rawResponse.json()

        if(initialisedConstant == false){
          document.title = `${rawData.prjName} Status Page`
          document.getElementById("statusPageBanner").innerText = `${rawData.prjName} Status Page`
          updateInterval = rawData.updInterval
          initialisedConstant = true
        }
        
      }
      function updateTime(){
        if (rawData && rawData.startTime != null){
          let now = Date.now()
          let startTimestamp = rawData.startTime
          let timeOnline = (now - startTimestamp)/1000
          document.getElementById("uptimeBanner").innerText = `Uptime: ${formatUptime(timeOnline)}`
        }
      }
      
      fetchRawData().then(()=>{
        setInterval(updateTime, 1000)
        setInterval(fetchRawData, updateInterval)
      })
      
    </script>
  </body>
</html>